{"remainingRequest":"/Users/jonny/Desktop/myProjects/Kalaam-core/FE/node_modules/babel-loader/lib/index.js!/Users/jonny/Desktop/myProjects/Kalaam-core/FE/node_modules/quasar/src/components/uploader/uploader-xhr-mixin.js","dependencies":[{"path":"/Users/jonny/Desktop/myProjects/Kalaam-core/FE/node_modules/quasar/src/components/uploader/uploader-xhr-mixin.js","mtime":499162500000},{"path":"/Users/jonny/Desktop/myProjects/Kalaam-core/FE/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jonny/Desktop/myProjects/Kalaam-core/FE/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKCmZ1bmN0aW9uIGdldEZuKHByb3ApIHsKICByZXR1cm4gdHlwZW9mIHByb3AgPT09ICdmdW5jdGlvbicgPyBwcm9wIDogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHByb3A7CiAgfTsKfQoKZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICB1cmw6IFtGdW5jdGlvbiwgU3RyaW5nXSwKICAgIG1ldGhvZDogewogICAgICB0eXBlOiBbRnVuY3Rpb24sIFN0cmluZ10sCiAgICAgICJkZWZhdWx0IjogJ1BPU1QnCiAgICB9LAogICAgZmllbGROYW1lOiB7CiAgICAgIHR5cGU6IFtGdW5jdGlvbiwgU3RyaW5nXSwKICAgICAgImRlZmF1bHQiOiBmdW5jdGlvbiBfZGVmYXVsdChmaWxlKSB7CiAgICAgICAgcmV0dXJuIGZpbGUubmFtZTsKICAgICAgfQogICAgfSwKICAgIGhlYWRlcnM6IFtGdW5jdGlvbiwgQXJyYXldLAogICAgZm9ybUZpZWxkczogW0Z1bmN0aW9uLCBBcnJheV0sCiAgICB3aXRoQ3JlZGVudGlhbHM6IFtGdW5jdGlvbiwgQm9vbGVhbl0sCiAgICBzZW5kUmF3OiBbRnVuY3Rpb24sIEJvb2xlYW5dLAogICAgYmF0Y2g6IFtGdW5jdGlvbiwgQm9vbGVhbl0sCiAgICBmYWN0b3J5OiBGdW5jdGlvbgogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHhocnM6IFtdLAogICAgICBwcm9taXNlczogW10sCiAgICAgIHdvcmtpbmdUaHJlYWRzOiAwCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHhoclByb3BzOiBmdW5jdGlvbiB4aHJQcm9wcygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB1cmw6IGdldEZuKHRoaXMudXJsKSwKICAgICAgICBtZXRob2Q6IGdldEZuKHRoaXMubWV0aG9kKSwKICAgICAgICBoZWFkZXJzOiBnZXRGbih0aGlzLmhlYWRlcnMpLAogICAgICAgIGZvcm1GaWVsZHM6IGdldEZuKHRoaXMuZm9ybUZpZWxkcyksCiAgICAgICAgZmllbGROYW1lOiBnZXRGbih0aGlzLmZpZWxkTmFtZSksCiAgICAgICAgd2l0aENyZWRlbnRpYWxzOiBnZXRGbih0aGlzLndpdGhDcmVkZW50aWFscyksCiAgICAgICAgc2VuZFJhdzogZ2V0Rm4odGhpcy5zZW5kUmF3KSwKICAgICAgICBiYXRjaDogZ2V0Rm4odGhpcy5iYXRjaCkKICAgICAgfTsKICAgIH0sCiAgICBpc1VwbG9hZGluZzogZnVuY3Rpb24gaXNVcGxvYWRpbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLndvcmtpbmdUaHJlYWRzID4gMDsKICAgIH0sCiAgICBpc0J1c3k6IGZ1bmN0aW9uIGlzQnVzeSgpIHsKICAgICAgcmV0dXJuIHRoaXMucHJvbWlzZXMubGVuZ3RoID4gMDsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGFib3J0OiBmdW5jdGlvbiBhYm9ydCgpIHsKICAgICAgdGhpcy54aHJzLmZvckVhY2goZnVuY3Rpb24gKHgpIHsKICAgICAgICB4LmFib3J0KCk7CiAgICAgIH0pOwoKICAgICAgaWYgKHRoaXMucHJvbWlzZXMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuYWJvcnRQcm9taXNlcyA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICB1cGxvYWQ6IGZ1bmN0aW9uIHVwbG9hZCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmNhblVwbG9hZCA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBxdWV1ZSA9IHRoaXMucXVldWVkRmlsZXMuc2xpY2UoMCk7CiAgICAgIHRoaXMucXVldWVkRmlsZXMgPSBbXTsKCiAgICAgIGlmICh0aGlzLnhoclByb3BzLmJhdGNoKHF1ZXVlKSkgewogICAgICAgIHRoaXMuX19ydW5GYWN0b3J5KHF1ZXVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBxdWV1ZS5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICBfdGhpcy5fX3J1bkZhY3RvcnkoW2ZpbGVdKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIF9fcnVuRmFjdG9yeTogZnVuY3Rpb24gX19ydW5GYWN0b3J5KGZpbGVzKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdGhpcy53b3JraW5nVGhyZWFkcysrOwoKICAgICAgaWYgKHR5cGVvZiB0aGlzLmZhY3RvcnkgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICB0aGlzLl9fdXBsb2FkRmlsZXMoZmlsZXMsIHt9KTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcmVzID0gdGhpcy5mYWN0b3J5KGZpbGVzKTsKCiAgICAgIGlmICghcmVzKSB7CiAgICAgICAgdGhpcy4kZW1pdCgnZmFjdG9yeS1mYWlsZWQnLCBuZXcgRXJyb3IoJ1FVcGxvYWRlcjogZmFjdG9yeSgpIGRvZXMgbm90IHJldHVybiBwcm9wZXJseScpLCBmaWxlcyk7CiAgICAgICAgdGhpcy53b3JraW5nVGhyZWFkcy0tOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXNbImNhdGNoIl0gPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIHJlcy50aGVuID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgdGhpcy5wcm9taXNlcy5wdXNoKHJlcyk7CgogICAgICAgIHZhciBmYWlsZWQgPSBmdW5jdGlvbiBmYWlsZWQoZXJyKSB7CiAgICAgICAgICBpZiAoX3RoaXMyLl9pc0JlaW5nRGVzdHJveWVkICE9PSB0cnVlICYmIF90aGlzMi5faXNEZXN0cm95ZWQgIT09IHRydWUpIHsKICAgICAgICAgICAgX3RoaXMyLnByb21pc2VzID0gX3RoaXMyLnByb21pc2VzLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgIHJldHVybiBwICE9PSByZXM7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKF90aGlzMi5wcm9taXNlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBfdGhpczIuYWJvcnRQcm9taXNlcyA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczIucXVldWVkRmlsZXMgPSBfdGhpczIucXVldWVkRmlsZXMuY29uY2F0KGZpbGVzKTsKICAgICAgICAgICAgZmlsZXMuZm9yRWFjaChmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgIF90aGlzMi5fX3VwZGF0ZUZpbGUoZiwgJ2ZhaWxlZCcpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMi4kZW1pdCgnZmFjdG9yeS1mYWlsZWQnLCBlcnIsIGZpbGVzKTsKCiAgICAgICAgICAgIF90aGlzMi53b3JraW5nVGhyZWFkcy0tOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHJlcy50aGVuKGZ1bmN0aW9uIChmYWN0b3J5KSB7CiAgICAgICAgICBpZiAoX3RoaXMyLmFib3J0UHJvbWlzZXMgPT09IHRydWUpIHsKICAgICAgICAgICAgZmFpbGVkKG5ldyBFcnJvcignQWJvcnRlZCcpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoX3RoaXMyLl9pc0JlaW5nRGVzdHJveWVkICE9PSB0cnVlICYmIF90aGlzMi5faXNEZXN0cm95ZWQgIT09IHRydWUpIHsKICAgICAgICAgICAgX3RoaXMyLnByb21pc2VzID0gX3RoaXMyLnByb21pc2VzLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgIHJldHVybiBwICE9PSByZXM7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgX3RoaXMyLl9fdXBsb2FkRmlsZXMoZmlsZXMsIGZhY3RvcnkpOwogICAgICAgICAgfQogICAgICAgIH0pWyJjYXRjaCJdKGZhaWxlZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fX3VwbG9hZEZpbGVzKGZpbGVzLCByZXMgfHwge30pOwogICAgICB9CiAgICB9LAogICAgX191cGxvYWRGaWxlczogZnVuY3Rpb24gX191cGxvYWRGaWxlcyhmaWxlcywgZmFjdG9yeSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBmb3JtID0gbmV3IEZvcm1EYXRhKCksCiAgICAgICAgICB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgICAgIHZhciBnZXRQcm9wID0gZnVuY3Rpb24gZ2V0UHJvcChuYW1lLCBhcmcpIHsKICAgICAgICByZXR1cm4gZmFjdG9yeVtuYW1lXSAhPT0gdm9pZCAwID8gZ2V0Rm4oZmFjdG9yeVtuYW1lXSkoYXJnKSA6IF90aGlzMy54aHJQcm9wc1tuYW1lXShhcmcpOwogICAgICB9OwoKICAgICAgdmFyIHVybCA9IGdldFByb3AoJ3VybCcsIGZpbGVzKTsKCiAgICAgIGlmICghdXJsKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigncS11cGxvYWRlcjogaW52YWxpZCBvciBubyBVUkwgc3BlY2lmaWVkJyk7CiAgICAgICAgdGhpcy53b3JraW5nVGhyZWFkcy0tOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGZpZWxkcyA9IGdldFByb3AoJ2Zvcm1GaWVsZHMnLCBmaWxlcyk7CiAgICAgIGZpZWxkcyAhPT0gdm9pZCAwICYmIGZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgIGZvcm0uYXBwZW5kKGZpZWxkLm5hbWUsIGZpZWxkLnZhbHVlKTsKICAgICAgfSk7CiAgICAgIHZhciB1cGxvYWRJbmRleCA9IDAsCiAgICAgICAgICB1cGxvYWRJbmRleFNpemUgPSAwLAogICAgICAgICAgdXBsb2FkZWRTaXplID0gMCwKICAgICAgICAgIG1heFVwbG9hZFNpemUgPSAwLAogICAgICAgICAgYWJvcnRlZDsKICAgICAgeGhyLnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgaWYgKGFib3J0ZWQgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBsb2FkZWQgPSBNYXRoLm1pbihtYXhVcGxvYWRTaXplLCBlLmxvYWRlZCk7CiAgICAgICAgX3RoaXMzLnVwbG9hZGVkU2l6ZSArPSBsb2FkZWQgLSB1cGxvYWRlZFNpemU7CiAgICAgICAgdXBsb2FkZWRTaXplID0gbG9hZGVkOwogICAgICAgIHZhciBzaXplID0gdXBsb2FkZWRTaXplIC0gdXBsb2FkSW5kZXhTaXplOwoKICAgICAgICBmb3IgKHZhciBpID0gdXBsb2FkSW5kZXg7IHNpemUgPiAwICYmIGkgPCBmaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGZpbGUgPSBmaWxlc1tpXSwKICAgICAgICAgICAgICB1cGxvYWRlZCA9IHNpemUgPiBmaWxlLnNpemU7CgogICAgICAgICAgaWYgKHVwbG9hZGVkKSB7CiAgICAgICAgICAgIHNpemUgLT0gZmlsZS5zaXplOwogICAgICAgICAgICB1cGxvYWRJbmRleCsrOwogICAgICAgICAgICB1cGxvYWRJbmRleFNpemUgKz0gZmlsZS5zaXplOwoKICAgICAgICAgICAgX3RoaXMzLl9fdXBkYXRlRmlsZShmaWxlLCAndXBsb2FkaW5nJywgZmlsZS5zaXplKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMy5fX3VwZGF0ZUZpbGUoZmlsZSwgJ3VwbG9hZGluZycsIHNpemUpOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgZmFsc2UpOwoKICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPCA0KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoeGhyLnN0YXR1cyAmJiB4aHIuc3RhdHVzIDwgNDAwKSB7CiAgICAgICAgICBfdGhpczMudXBsb2FkZWRGaWxlcyA9IF90aGlzMy51cGxvYWRlZEZpbGVzLmNvbmNhdChmaWxlcyk7CiAgICAgICAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgIF90aGlzMy5fX3VwZGF0ZUZpbGUoZiwgJ3VwbG9hZGVkJyk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczMuJGVtaXQoJ3VwbG9hZGVkJywgewogICAgICAgICAgICBmaWxlczogZmlsZXMsCiAgICAgICAgICAgIHhocjogeGhyCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWJvcnRlZCA9IHRydWU7CiAgICAgICAgICBfdGhpczMudXBsb2FkZWRTaXplIC09IHVwbG9hZGVkU2l6ZTsKICAgICAgICAgIF90aGlzMy5xdWV1ZWRGaWxlcyA9IF90aGlzMy5xdWV1ZWRGaWxlcy5jb25jYXQoZmlsZXMpOwogICAgICAgICAgZmlsZXMuZm9yRWFjaChmdW5jdGlvbiAoZikgewogICAgICAgICAgICBfdGhpczMuX191cGRhdGVGaWxlKGYsICdmYWlsZWQnKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzMy4kZW1pdCgnZmFpbGVkJywgewogICAgICAgICAgICBmaWxlczogZmlsZXMsCiAgICAgICAgICAgIHhocjogeGhyCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF90aGlzMy53b3JraW5nVGhyZWFkcy0tOwogICAgICAgIF90aGlzMy54aHJzID0gX3RoaXMzLnhocnMuZmlsdGVyKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICByZXR1cm4geCAhPT0geGhyOwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgeGhyLm9wZW4oZ2V0UHJvcCgnbWV0aG9kJywgZmlsZXMpLCB1cmwpOwoKICAgICAgaWYgKGdldFByb3AoJ3dpdGhDcmVkZW50aWFscycsIGZpbGVzKSA9PT0gdHJ1ZSkgewogICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlOwogICAgICB9CgogICAgICB2YXIgaGVhZGVycyA9IGdldFByb3AoJ2hlYWRlcnMnLCBmaWxlcyk7CiAgICAgIGhlYWRlcnMgIT09IHZvaWQgMCAmJiBoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24gKGhlYWQpIHsKICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkLm5hbWUsIGhlYWQudmFsdWUpOwogICAgICB9KTsKICAgICAgdmFyIHNlbmRSYXcgPSBnZXRQcm9wKCdzZW5kUmF3JywgZmlsZXMpOwogICAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgX3RoaXMzLl9fdXBkYXRlRmlsZShmaWxlLCAndXBsb2FkaW5nJywgMCk7CgogICAgICAgIGlmIChzZW5kUmF3ICE9PSB0cnVlKSB7CiAgICAgICAgICBmb3JtLmFwcGVuZChnZXRQcm9wKCdmaWVsZE5hbWUnLCBmaWxlKSwgZmlsZSwgZmlsZS5uYW1lKTsKICAgICAgICB9CgogICAgICAgIGZpbGUueGhyID0geGhyOwoKICAgICAgICBmaWxlLl9fYWJvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICB9OwoKICAgICAgICBtYXhVcGxvYWRTaXplICs9IGZpbGUuc2l6ZTsKICAgICAgfSk7CiAgICAgIHRoaXMuJGVtaXQoJ3VwbG9hZGluZycsIHsKICAgICAgICBmaWxlczogZmlsZXMsCiAgICAgICAgeGhyOiB4aHIKICAgICAgfSk7CiAgICAgIHRoaXMueGhycy5wdXNoKHhocik7CgogICAgICBpZiAoc2VuZFJhdyA9PT0gdHJ1ZSkgewogICAgICAgIHhoci5zZW5kKG5ldyBCbG9iKGZpbGVzKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgeGhyLnNlbmQoZm9ybSk7CiAgICAgIH0KICAgIH0KICB9Cn07"},{"version":3,"sources":["/Users/jonny/Desktop/myProjects/Kalaam-core/FE/node_modules/quasar/src/components/uploader/uploader-xhr-mixin.js"],"names":["getFn","prop","props","url","Function","String","method","type","fieldName","file","name","headers","Array","formFields","withCredentials","Boolean","sendRaw","batch","factory","data","xhrs","promises","workingThreads","computed","xhrProps","isUploading","isBusy","length","methods","abort","forEach","x","abortPromises","upload","canUpload","queue","queuedFiles","slice","__runFactory","files","__uploadFiles","res","$emit","Error","then","push","failed","err","_isBeingDestroyed","_isDestroyed","filter","p","concat","f","__updateFile","form","FormData","xhr","XMLHttpRequest","getProp","arg","console","error","fields","field","append","value","uploadIndex","uploadIndexSize","uploadedSize","maxUploadSize","aborted","addEventListener","e","loaded","Math","min","size","i","uploaded","onreadystatechange","readyState","status","uploadedFiles","open","head","setRequestHeader","__abort","send","Blob"],"mappings":"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","sourcesContent":["function getFn (prop) {\n  return typeof prop === 'function'\n    ? prop\n    : () => prop\n}\n\nexport default {\n  props: {\n    url: [ Function, String ],\n    method: {\n      type: [ Function, String ],\n      default: 'POST'\n    },\n    fieldName: {\n      type: [ Function, String ],\n      default: file => file.name\n    },\n    headers: [ Function, Array ],\n    formFields: [ Function, Array ],\n    withCredentials: [ Function, Boolean ],\n    sendRaw: [ Function, Boolean ],\n\n    batch: [ Function, Boolean ],\n    factory: Function\n  },\n\n  data () {\n    return {\n      xhrs: [],\n      promises: [],\n      workingThreads: 0\n    }\n  },\n\n  computed: {\n    xhrProps () {\n      return {\n        url: getFn(this.url),\n        method: getFn(this.method),\n        headers: getFn(this.headers),\n        formFields: getFn(this.formFields),\n        fieldName: getFn(this.fieldName),\n        withCredentials: getFn(this.withCredentials),\n        sendRaw: getFn(this.sendRaw),\n        batch: getFn(this.batch)\n      }\n    },\n\n    isUploading () {\n      return this.workingThreads > 0\n    },\n\n    isBusy () {\n      return this.promises.length > 0\n    }\n  },\n\n  methods: {\n    abort () {\n      this.xhrs.forEach(x => { x.abort() })\n\n      if (this.promises.length > 0) {\n        this.abortPromises = true\n      }\n    },\n\n    upload () {\n      if (this.canUpload === false) {\n        return\n      }\n\n      const queue = this.queuedFiles.slice(0)\n      this.queuedFiles = []\n\n      if (this.xhrProps.batch(queue)) {\n        this.__runFactory(queue)\n      }\n      else {\n        queue.forEach(file => {\n          this.__runFactory([ file ])\n        })\n      }\n    },\n\n    __runFactory (files) {\n      this.workingThreads++\n\n      if (typeof this.factory !== 'function') {\n        this.__uploadFiles(files, {})\n        return\n      }\n\n      const res = this.factory(files)\n\n      if (!res) {\n        this.$emit(\n          'factory-failed',\n          new Error('QUploader: factory() does not return properly'),\n          files\n        )\n        this.workingThreads--\n      }\n      else if (typeof res.catch === 'function' && typeof res.then === 'function') {\n        this.promises.push(res)\n\n        const failed = err => {\n          if (this._isBeingDestroyed !== true && this._isDestroyed !== true) {\n            this.promises = this.promises.filter(p => p !== res)\n\n            if (this.promises.length === 0) {\n              this.abortPromises = false\n            }\n\n            this.queuedFiles = this.queuedFiles.concat(files)\n            files.forEach(f => { this.__updateFile(f, 'failed') })\n\n            this.$emit('factory-failed', err, files)\n            this.workingThreads--\n          }\n        }\n\n        res.then(factory => {\n          if (this.abortPromises === true) {\n            failed(new Error('Aborted'))\n          }\n          else if (this._isBeingDestroyed !== true && this._isDestroyed !== true) {\n            this.promises = this.promises.filter(p => p !== res)\n            this.__uploadFiles(files, factory)\n          }\n        }).catch(failed)\n      }\n      else {\n        this.__uploadFiles(files, res || {})\n      }\n    },\n\n    __uploadFiles (files, factory) {\n      const\n        form = new FormData(),\n        xhr = new XMLHttpRequest()\n\n      const getProp = (name, arg) => {\n        return factory[name] !== void 0\n          ? getFn(factory[name])(arg)\n          : this.xhrProps[name](arg)\n      }\n\n      const url = getProp('url', files)\n\n      if (!url) {\n        console.error('q-uploader: invalid or no URL specified')\n        this.workingThreads--\n        return\n      }\n\n      const fields = getProp('formFields', files)\n      fields !== void 0 && fields.forEach(field => {\n        form.append(field.name, field.value)\n      })\n\n      let\n        uploadIndex = 0,\n        uploadIndexSize = 0,\n        uploadedSize = 0,\n        maxUploadSize = 0,\n        aborted\n\n      xhr.upload.addEventListener('progress', e => {\n        if (aborted === true) { return }\n\n        const loaded = Math.min(maxUploadSize, e.loaded)\n\n        this.uploadedSize += loaded - uploadedSize\n        uploadedSize = loaded\n\n        let size = uploadedSize - uploadIndexSize\n        for (let i = uploadIndex; size > 0 && i < files.length; i++) {\n          const\n            file = files[i],\n            uploaded = size > file.size\n\n          if (uploaded) {\n            size -= file.size\n            uploadIndex++\n            uploadIndexSize += file.size\n            this.__updateFile(file, 'uploading', file.size)\n          }\n          else {\n            this.__updateFile(file, 'uploading', size)\n            return\n          }\n        }\n      }, false)\n\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState < 4) {\n          return\n        }\n\n        if (xhr.status && xhr.status < 400) {\n          this.uploadedFiles = this.uploadedFiles.concat(files)\n          files.forEach(f => { this.__updateFile(f, 'uploaded') })\n          this.$emit('uploaded', { files, xhr })\n        }\n        else {\n          aborted = true\n          this.uploadedSize -= uploadedSize\n          this.queuedFiles = this.queuedFiles.concat(files)\n          files.forEach(f => { this.__updateFile(f, 'failed') })\n          this.$emit('failed', { files, xhr })\n        }\n\n        this.workingThreads--\n        this.xhrs = this.xhrs.filter(x => x !== xhr)\n      }\n\n      xhr.open(\n        getProp('method', files),\n        url\n      )\n\n      if (getProp('withCredentials', files) === true) {\n        xhr.withCredentials = true\n      }\n\n      const headers = getProp('headers', files)\n      headers !== void 0 && headers.forEach(head => {\n        xhr.setRequestHeader(head.name, head.value)\n      })\n\n      const sendRaw = getProp('sendRaw', files)\n\n      files.forEach(file => {\n        this.__updateFile(file, 'uploading', 0)\n        if (sendRaw !== true) {\n          form.append(getProp('fieldName', file), file, file.name)\n        }\n        file.xhr = xhr\n        file.__abort = () => { xhr.abort() }\n        maxUploadSize += file.size\n      })\n\n      this.$emit('uploading', { files, xhr })\n      this.xhrs.push(xhr)\n\n      if (sendRaw === true) {\n        xhr.send(new Blob(files))\n      }\n      else {\n        xhr.send(form)\n      }\n    }\n  }\n}\n"]}]}